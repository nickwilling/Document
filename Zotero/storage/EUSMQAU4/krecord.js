var log = { url: "//ishufang.cnki.net/KRecord", ajax: function (n) { var i, t; n = n || {}, n.type = (n.type || "GET").toUpperCase(), n.dataType = n.dataType || "json", i = this.formatParams(n.data), t = window.XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"), t.onreadystatechange = function () { if (t.readyState == 4) { var i = t.status; i >= 200 && i < 300 ? n.success && n.success(t.responseText, t.responseXML) : n.fail && n.fail(i) } }, n.type == "GET" ? (t.open("GET", n.url + "?" + i, !0), t.send(null)) : n.type == "POST" && (t.open("POST", n.url, !0), t.setRequestHeader("Content-Type", "application/x-www-form-urlencoded"), t.send(i)) }, formatParams: function (n) { function r(n) { return typeof n == "object" && Object.prototype.toString.call(n).toLowerCase() == "[object object]" && !n.length } var t, i; if (!r(n)) return n; t = []; for (i in n) t.push(encodeURIComponent(i) + "=" + encodeURIComponent(n[i])); return t.push("referer=" + document.referrer), t.push("url=" + window.location.href), t.push(("v=" + Math.random()).replace(".", "")), t.join("&") }, jsonp: function (n) { var i, r, u, t; if (n = n || {}, !n.url || !n.callback) throw new Error("参数不合法"); i = ("jsonp_" + Math.random()).replace(".", ""), r = document.getElementsByTagName("head")[0], n.data[n.callback] = i, u = this.formatParams(n.data), t = document.createElement("script"), r.appendChild(t), window[i] = function (u) { r.removeChild(t), clearTimeout(t.timer), window[i] = null, n.success && n.success(u) }, t.src = n.url + "?" + u, n.time && (t.timer = setTimeout(function () { window[i] = null, r.removeChild(t), n.fail && n.fail({ message: "超时" }) }, time)) } }; log.AddException = function (n, t, i, r) { log.jsonp({ url: log.url + "/log/Exception", data: { NameSpace: n, Value: t, ExecutionTime: i, username: r }, callback: "aaa", success: function () { }, fail: function () { } }) }, log.AddSearch = function (n, t, i, r) { log.AddCustom(n, "search", t, i, r) }, log.AddGroup = function (n, t, i, r) { log.AddCustom(n, "group", t, i, r) }, log.AddView = function (n, t, i, r) { log.AddCustom(n, "view", t, i, r) }, log.AddOrder = function (n, t, i, r) { log.AddCustom(n, "order", t, i, r) }, log.AddDownload = function (n, t, i, r) { log.AddCustom(n, "download", t, i, r) }, log.AddTurnPage = function (n, t, i, r) { log.AddCustom(n, "turnPage", t, i, r) }, log.AddRead = function (n, t, i, r) { log.AddCustom(n, "read", t, i, r) }, log.AddNavigation = function (n, t, i, r) { log.AddCustom(n, "navigation", t, i, r) }, log.AddCustom = function (n, t, i, r, u) { log.jsonp({ url: log.url + "/log/UserBehaviour", data: { NameSpace: n, Value: i, ExecutionTime: r, username: u, key: t }, callback: "aaa", success: function () { }, fail: function () { } }) }